var St=Object.defineProperty;var It=(n,e,t)=>e in n?St(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ie=(n,e,t)=>(It(n,typeof e!="symbol"?e+"":e,t),t);import{_ as ke}from"./BalAsset-68194947.js";import{bS as Fe,E as V,bT as Se,bN as Z,G as j,bU as Pt,bV as xt,bW as Ie,bX as ce,bY as $t,bZ as Bt,Z as R,aF as Mt,aM as Et,j as ue,b_ as Ae,A as Lt,b$ as Ct,c0 as Jt,bv as We,bp as qt,bw as jt,c1 as Ot,c as r,m as Ft,r as Rt,Q as Nt,l as ee,y as de,c2 as Pe,u as _e,ba as Ht,c3 as Vt,c4 as Wt,b7 as zt,L as Dt,as as Ut,a1 as ge,a2 as ze,bc as De,c5 as le,c6 as Gt,c7 as Qt,c8 as Zt,bd as Kt,d as W,C as o,o as u,B as T,x as xe,b1 as ne,w as L,f as I,aA as pe,al as Yt,k as $e,a9 as Xt,a as O,e as X,t as F,b as J,U as N,a8 as Be,F as K,a3 as Ue,aE as Y,am as eo,av as Ge,c9 as to,at as Re,a7 as Qe,ca as Ze,cb as Ke,ay as oo,cc as re,z as so,P as ao,cd as Ne,p as no,g as io,_ as Ye,a4 as lo,ce as ro,az as Xe,aB as co,n as uo,H as po,aD as Te,D as mo,cf as et,aV as vo}from"./index-60943df8.js";import{u as tt}from"./useBreakpoints-76e5f77c.js";import{_ as fo,u as ho}from"./MyWallet.vue_vue_type_script_setup_true_lang-7d148009.js";import{u as go,R as He,a as ko}from"./useRelayerApproval-8e49cdc5.js";import{u as _o}from"./useTxState-bfde8eab.js";import{d as yo,H as wo,R as bo,T as Ve,L as Ao}from"./TokenAmounts-8735d742.js";import{o as To}from"./helpers-7076a817.js";import{u as So,A as Io}from"./useTokenApprovalActions-885c33f2.js";import{u as ot}from"./pool.provider-3818d1b8.js";import{_ as Po}from"./BalAccordion.vue_vue_type_script_setup_true_lang-cc7bb03c.js";import{_ as xo}from"./BalTabs.vue_vue_type_style_index_0_lang-6658ba02.js";import{S as $o,_ as Bo}from"./SwapSettingsPopover.vue_vue_type_style_index_0_lang-69b1f8b8.js";import{_ as Mo}from"./BalCheckbox-acca24cf.js";import{_ as st}from"./BalAlert-7103ffb1.js";import{_ as Me}from"./BalTooltip.vue_vue_type_style_index_0_lang-8cf64573.js";import{_ as Eo}from"./StakePreviewModal.vue_vue_type_script_setup_true_lang-d41a00fd.js";import{_ as Lo}from"./TokenInput.vue_vue_type_script_setup_true_lang-da11efe6.js";import{a as Co}from"./validations-cc161b3f.js";import{_ as Jo}from"./BalCircle-528e0679.js";import{_ as qo,a as jo}from"./BalDataListRow.vue_vue_type_script_setup_true_lang-bc4f6b21.js";import{_ as Oo,u as Fo}from"./useDisabledJoinPool-1947dad7.js";import{_ as Ro}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-cd43f961.js";import{_ as No}from"./ConfirmationIndicator.vue_vue_type_script_setup_true_lang-e065ab89.js";import{u as Ho,p as Vo}from"./pool-staking.provider-018db08c.js";import{_ as Wo}from"./FeedbackCard.vue_vue_type_script_setup_true_lang-f0ae37aa.js";import{u as zo}from"./user-tokens.provider-a558a35f.js";import"./BalAssetSet-c1957457.js";import"./vue-query-ecc7fe75.js";import"./constants-dee7c074.js";import"./usePoolQuery-da6fa219.js";import"./BalPopover-5c2abaf0.js";import"./BalBtnGroup-35a6c106.js";import"./BalVStack.vue_vue_type_script_setup_true_lang-a25ce916.js";import"./BalHStack.vue_vue_type_script_setup_true_lang-f88d7582.js";import"./BalTextInput-8696f087.js";import"./SelectTokenModal-bd0cd63c.js";import"./anime.es-37453147.js";import"./numeral-088ce989.js";var Ee=(n=>(n[n.PoolTokens=0]="PoolTokens",n[n.SingleToken=1]="SingleToken",n))(Ee||{});const ye=[{value:0,label:Fe.global.t("investment.tabs.poolTokens")},{value:1,label:Fe.global.t("investment.tabs.singleToken")}],at=V(ye[0].value);function Do(){at.value=ye[0].value}function nt(){return{activeTab:at,resetTabs:Do}}class Uo{constructor(e,t){ie(this,"lastSwapRoute");this.pool=e,this.sdk=t}async join(e){const{signer:t,slippageBsp:s}=e,a=await t.getAddress();if(await this.queryJoin(e),!this.lastSwapRoute)throw new Error("Could not fetch swap route for join.");const{to:i,data:d,value:h}=this.getSwapAttributes(this.lastSwapRoute,s,a);return new Se(t).raw.sendTransaction({to:i,data:d,value:h})}async queryJoin({amountsIn:e,tokensIn:t,signer:s}){var c;if(e.length===0)throw new Error("Missing amounts to join with.");const a=e[0],i=Z(t,a.address);if(!i)throw new Error("Missing critical token metadata.");if(!a.value||j(a.value).eq(0))return{bptOut:"0",priceImpact:0};Pt.value||await xt();const d=To(a.value,i.decimals),h=Ie(d,i.decimals),g=await this.getGasPrice(s);this.lastSwapRoute=await this.sdk.swaps.findRouteGivenIn({tokenIn:this.formatAddressForSor(a.address),tokenOut:this.pool.value.address,amount:h,gasPrice:g,maxPools:4});const k=ce(this.lastSwapRoute.returnAmount,((c=this.pool.value.onchain)==null?void 0:c.decimals)||18);if(j(k).eq(0))throw new Error("Not enough liquidity.");const w=this.calcPriceImpact(a.value,k,this.lastSwapRoute.marketSp);return{bptOut:k,priceImpact:w}}calcPriceImpact(e,t,s){const i=j(e).div(t).div(s).minus(1)||1;return Math.max(0,i.toNumber())}async getGasPrice(e){const t=(await e.getGasPrice()).toNumber();if(!t)throw new Error("Failed to fetch gas price.");return $t.from(t)}getSwapAttributes(e,t,s){const a=Bt(60).toString();return this.sdk.swaps.buildSwap({userAddress:s,swapInfo:e,kind:0,deadline:a,maxSlippage:t})}formatAddressForSor(e){return R(e,Mt)?Et.ZeroAddress:e}}class Go{constructor(e,t){ie(this,"lastJoinRes");this.pool=e,this.sdk=t}async join(e){if(await this.queryJoin(e),!this.lastJoinRes)throw new Error("Could not query generalised join");const t=new Se(e.signer),{to:s,encodedCall:a,value:i}=this.lastJoinRes;return t.raw.sendTransaction({to:s,data:a,value:i})}async queryJoin({amountsIn:e,tokensIn:t,signer:s,slippageBsp:a,relayerSignature:i,approvalActions:d}){var A;const h=e.map(({address:_,value:B})=>{const P=Z(t,_);if(!P||!P.decimals)throw new Error(`Token metadata missing for: ${_}`);return Ie(B||"0",P.decimals).toString()}),g=e.map(({address:_})=>this.formatTokenAddress(_)),k=await s.getAddress(),w=a.toString(),c=this.pool.value.id,l=e.some(_=>!_.valid),m=e.some(_=>R(_.address,ue.network.nativeAsset.address)),p=this.getSimulationType({isNativeAssetJoin:m,hasInvalidAmounts:l,approvalActionsLength:d.length});if(console.log({simulationType:p}),this.lastJoinRes=await this.sdk.pools.generalisedJoin(c,g,h,k,w,s,p,i),!this.lastJoinRes)throw new Error("Failed to fetch expected output.");const b=ce(this.lastJoinRes.expectedOut,((A=this.pool.value.onchain)==null?void 0:A.decimals)||18),$=j(ce(this.lastJoinRes.priceImpact,18)).toNumber();if(j(b).eq(0))throw new Error("Not enough liquidity.");return{bptOut:b,priceImpact:$}}getSimulationType({isNativeAssetJoin:e,hasInvalidAmounts:t,approvalActionsLength:s}){return e?Ae.VaultModel:!t&&!s?Ae.Static:Ae.VaultModel}formatTokenAddress(e){const{nativeAsset:t}=ue.network.tokens.Addresses;return R(e,t)?Lt:e}}class Qo{constructor(e,t){ie(this,"joinRes");this.pool=e,this.sdk=t}async join(e){if(await this.queryJoin(e),!this.joinRes)throw new Error("Could not query generalised join");const t=new Se(e.signer),{to:s,data:a,value:i}=this.joinRes;return t.raw.sendTransaction({to:s,data:a,value:i})}async queryJoin({amountsIn:e,tokensIn:t,signer:s,slippageBsp:a}){var $;const i=e.map(({address:A})=>A),d=this.formatPoolTokensList(i),h=d.map(A=>{var P;const _=Z(t,A);if(!_)return"0";const B=(P=Ct(e,A))==null?void 0:P.value;return Ie(B||"0",_.decimals).toString()}),g=await s.getAddress(),k=a.toString(),w=await this.sdk.pools.find(this.pool.value.id);if(!w)throw new Error("Failed to find pool: "+this.pool.value.id);const c=d.map(A=>Jt(A));if(this.joinRes=await w.buildJoin(g,c,h,k),!this.joinRes)throw new Error("Failed to fetch expected output.");const{expectedBPTOut:l}=this.joinRes;if(j(l).eq(0))throw new Error("Failed to fetch expected output.");const m=ce(l,(($=this.pool.value.onchain)==null?void 0:$.decimals)||18),p=await w.calcPriceImpact(h,l,!0),b=Number(ce(p,18));return{bptOut:m,priceImpact:b}}formatPoolTokensList(e){const{nativeAsset:t,wNativeAsset:s}=ue.network.tokens.Addresses,a=We(e,t),i=qt(this.pool.value);return a?i.map(d=>R(d,s)?t:d):i}}var he=(n=>(n.Swap="Swap",n.Generalised="Generalised",n.ExactIn="ExactIn",n))(he||{});class Zo{constructor(e,t=jt()){ie(this,"joinHandler");this.pool=e,this.sdk=t,this.joinHandler=this.setJoinHandler("Generalised")}setJoinHandler(e){const{pool:t,sdk:s}=this,a=[t,s];switch(e){case"Swap":return this.joinHandler=new Uo(...a);case"Generalised":return this.joinHandler=new Go(...a);case"ExactIn":return this.joinHandler=new Qo(...a);default:throw new Error(`Pool type not handled: ${t.value.poolType}`)}}async join(e){return this.joinHandler.join(e)}async queryJoin(e){return this.joinHandler.queryJoin(e)}}function Ko(n,e){throw Error(n,{cause:e})}const Yo=(n,e=1e3)=>{const t=V(!1),s=V([]),a=V("0"),i=V(0),d=V(!1),h=V(""),g=V([]),k=V(!1),w=yo(yt,e),c=r(()=>t.value&&!z.value),l=Ft(Nt.Pools.Joins.QueryJoin(s,k),w,Rt({enabled:c,refetchOnWindowFocus:!1})),m=new Zo(n),{getTokens:p,injectTokens:b,priceFor:$,nativeAsset:A,wrappedNativeAsset:_}=ee(),{toFiat:B}=de(),{slippageBsp:P}=Pe(),{getSigner:H,appNetworkConfig:y}=_e(),{transactionDeadline:v}=Gt(),{txState:q,txInProgress:z,resetTxState:D}=_o(),oe=go(He.BATCH),{getTokenApprovalActions:se,updateAllowancesFor:S}=So(),{relayerSignature:E,relayerApprovalAction:U}=ko(He.BATCH),x=r(()=>Ht(n.value)),C=r(()=>Vt(n.value)),M=r(()=>p(s.value.map(f=>f.address))),G=r(()=>j(i.value).isGreaterThanOrEqualTo(wo)),me=r(()=>j(i.value).isGreaterThanOrEqualTo(bo)),ve=r(()=>G.value?d.value:!0),Le=r(()=>s.value.every(f=>f.valid===!0)&&ve.value),Ce=r(()=>s.value.some(f=>j(f.value).gt(0))),fe=r(()=>s.value.filter(f=>j(f.value).gt(0))),ct=r(()=>!fe.value.every(f=>j($(f.address)).gt(0))),ut=r(()=>{const f=s.value.map(Q=>B(Q.value||0,Q.address));return Wt(f).toString()}),dt=r(()=>zt(n.value,a.value)),pt=r(()=>x.value&&!k.value&&!(oe.isUnlocked.value||E.value)),mt=r(()=>s.value.map(f=>({address:f.address,amount:f.value,spender:y.addresses.vault}))),vt=r(()=>l.isFetching.value),ft=r(()=>{var f;return(f=l.error.value)==null?void 0:f.message}),ae=r(()=>x.value?k.value?he.Swap:he.Generalised:he.ExactIn),ht=r(()=>!Dt(n.value.poolType));function Je(f){s.value=f}function gt(f){Je(f.map(Q=>({address:Q,value:"",valid:!0})))}function kt(){s.value.forEach((f,Q)=>{s.value[Q].value=""})}function _t(){a.value="0",i.value=0,l.remove()}async function we(){const f=await se({amountsToApprove:mt.value,spender:y.addresses.vault,actionType:Io.AddLiquidity,skipAllowanceCheck:!0});g.value=pt.value?[U.value,...f]:f}function qe(){return Ce.value?!0:(i.value=0,!1)}async function yt(){if(!qe())return null;try{if(m.setJoinHandler(ae.value),await we(),console.log("joinHandler:",ae.value),!qe())return null;const f=await m.queryJoin({amountsIn:fe.value,tokensIn:M.value,signer:H(),slippageBsp:P.value,relayerSignature:E.value,approvalActions:g.value,transactionDeadline:v.value});return a.value=f.bptOut,i.value=f.priceImpact,f}catch(f){je(f,l),Ko("Failed to construct join.",f)}}async function wt(){try{return h.value="",m.setJoinHandler(ae.value),await we(),console.log("joinHandler:",ae.value),await m.join({amountsIn:fe.value,tokensIn:M.value,signer:H(),slippageBsp:P.value,relayerSignature:E.value,approvalActions:g.value,transactionDeadline:v.value})}catch(f){throw je(f),h.value=f.message,f}}function bt(f){k.value=f}function At(f){const Q=f?A.address:_.value.address,be=f?_.value.address:A.address,Oe=s.value.find(Tt=>R(be,Tt.address));Oe&&(Oe.address=Q)}async function je(f,Q){const be=await H().getAddress();Ut({error:f,action:"invest",query:Q,context:{level:"fatal",extra:{joinHandler:ae.value,params:JSON.stringify({amountsIn:fe.value,tokensIn:M.value,signer:be,slippageBsp:P.value,relayerSignature:E.value,approvalActions:g.value,transactionDeadline:v.value},null,2)}}})}return ge(k,()=>{_t(),m.setJoinHandler(ae.value)}),ge(U,async()=>await we()),ze(()=>{b(C.value),S(y.addresses.vault)}),De(()=>t.value=!0),{amountsIn:s,highPriceImpactAccepted:d,txState:q,pool:le(n),isSingleAssetJoin:le(k),bptOut:le(a),priceImpact:le(i),txError:le(h),poolJoinTokens:C,isLoadingQuery:vt,queryError:ft,highPriceImpact:G,rektPriceImpact:me,hasAcceptedHighPriceImpact:ve,hasValidInputs:Le,hasAmountsIn:Ce,fiatValueIn:ut,fiatValueOut:dt,txInProgress:z,approvalActions:g,missingPricesIn:ct,tokensIn:M,supportsProportionalOptimization:ht,setAmountsIn:Je,setTokensIn:gt,resetAmounts:kt,join:wt,resetTxState:D,setIsSingleAssetJoin:bt,setJoinWithNativeAsset:At,queryJoinQuery:l}},it=Symbol(Qt.Providers.JoinPool);function Xo(n){const e=Yo(n);return Ot(it,e),e}const te=()=>Zt(it);function es(){const{pool:n,isLoadingPool:e}=ot(),{setAmountsIn:t,setJoinWithNativeAsset:s,isSingleAssetJoin:a,amountsIn:i}=te(),{nativeAsset:d,wrappedNativeAsset:h,getMaxBalanceFor:g}=ee(),{activeTab:k}=nt(),w=r(()=>{var m;return(m=n.value)!=null&&m.address?[n.value.address]:[]});function c(m,p){if(a.value)t([{address:m,value:p,valid:!0}]);else{const b=R(m,d.address),$=R(m,h.value.address);(b||$)&&s(b);const A=i.value.find(_=>R(m,_.address));A&&(A.valid=!0,A.value=p)}}function l(m,p){const b=g(m);p?c(m,b):(k.value=ye[Ee.SingleToken].value,Kt(()=>{c(m,b)}))}return{handleMyWalletTokenClick:l,isLoadingPool:e,pool:n,excludedTokens:w,amountsIn:i,setAmountsIn:t,activeTab:k}}const lt=W({__name:"MyWallet",setup(n){const{handleMyWalletTokenClick:e,isLoadingPool:t,pool:s,excludedTokens:a}=es();return(i,d)=>{const h=ke;return o(t)||!o(s)?(u(),T(h,{key:0,class:"h-64"})):(u(),T(fo,{key:1,excludedTokens:o(a),pool:o(s),"onClick:asset":o(e)},null,8,["excludedTokens","pool","onClick:asset"]))}}}),ts=W({__name:"Accordion",props:{pool:{}},setup(n){const e=n,t=r(()=>e.pool),{hasNativeBalance:s,nativeBalance:a,nativeCurrency:i}=ho(),{t:d}=xe(),{isDeepPool:h}=ne(t),g=r(()=>s?`${a.value} ${i}`:""),k=r(()=>h.value?`${d("myWallet2")} ${g.value}`:d("poolTransfer.myWalletTokensCard.title"));return(w,c)=>(u(),T(Po,{sections:[{title:k.value,id:"myWalletTokens"}]},{myWalletTokens:L(()=>[I(lt,{pool:t.value},null,8,["pool"])]),_:1},8,["sections"]))}}),os={key:0,class:"flex items-center mb-4"},ss=["innerHTML"],as=W({__name:"WrapStEthLink",props:{pool:{}},setup(n){const e=n,{isMainnetWstETHPool:t}=ne(pe(e,"pool")),{networkConfig:s}=Yt(),{getToken:a}=ee(),{networkSlug:i}=$e(),d=r(()=>a(s.tokens.Addresses.stETH||"")),h=r(()=>a(s.tokens.Addresses.wstETH||""));return(g,k)=>{const w=Xt("router-link"),c=Be,l=Me;return o(t)?(u(),O("div",os,[I(w,{to:{name:"swap",params:{networkSlug:o(i),assetIn:d.value.address,assetOut:h.value.address}},class:"text-xs underline text-secondary"},{default:L(()=>[X(F(g.$t("wrapInstruction",[d.value.symbol,h.value.symbol])),1)]),_:1},8,["to"]),I(l,null,{activator:L(()=>[I(c,{name:"info",size:"xs",class:"ml-2 text-gray-400 dark:text-gray-500"})]),default:L(()=>[J("div",{innerHTML:g.$t("wrapStEthTooltip")},null,8,ss)]),_:1})])):N("",!0)}}}),ns=W({__name:"Summary",props:{pool:{},fiatTotal:{},priceImpact:{},isLoadingPriceImpact:{type:Boolean,default:!1},highPriceImpact:{type:Boolean,default:!1},summaryTitle:{default:void 0}},setup(n){const{fNum:e}=de(),{currency:t}=Pe();return(s,a)=>{const i=Me,d=qo,h=ke,g=jo;return u(),T(g,{title:s.$t("summary")},{default:L(()=>[I(d,{label:s.$t("investment.preview.summary.total")},{value:L(()=>[X(F(o(e)(s.fiatTotal,o(K).fiat))+" ",1),I(i,{text:s.$t("tooltips.addLiquidity.total",[o(t).toUpperCase()]),iconSize:"sm",class:"ml-2"},null,8,["text"])]),_:1},8,["label"]),I(d,{label:s.$t("priceImpact"),class:Y({"bg-red-50 dark:bg-red-500 text-red-500 dark:text-white":s.highPriceImpact})},{value:L(()=>[s.isLoadingPriceImpact?(u(),T(h,{key:0,class:"w-10 h-6"})):(u(),O(Ue,{key:1},[X(F(o(e)(s.priceImpact,o(K).percent))+" ",1),I(i,{text:s.$t("tooltips.addLiquidity.priceImpact"),iconSize:"sm",iconName:s.highPriceImpact?"alert-triangle":"info",iconClass:s.highPriceImpact?"text-red-500 dark:text-white":"text-gray-300",width:"72",class:"ml-2"},null,8,["text","iconName","iconClass"])],64))]),_:1},8,["label","class"])]),_:1},8,["title"])}}}),is={key:1},ls=W({__name:"Actions",props:{pool:{}},emits:["success","showStakeModal"],setup(n,{emit:e}){const t=n,s=e,{t:a}=xe(),{fNum:i}=de(),{addTransaction:d}=eo(),{lockablePoolId:h}=Ge(),{isStakablePool:g}=Ho(),{isMismatchedNetwork:k}=_e(),{poolWeightsLabel:w}=ne(pe(t,"pool")),{rektPriceImpact:c,fiatValueOut:l,join:m,txState:p,resetTxState:b,approvalActions:$}=te(),{networkSlug:A}=$e(),_=V($.value),B=r(()=>[..._.value,{label:a("addLiquidity"),loadingLabel:a("investment.preview.loadingLabel.investment"),confirmingLabel:a("confirming"),action:y,stepTooltip:a("investmentTooltip")}]);async function P(v,q){p.receipt=v,p.confirmedAt=q,p.confirmed=!0,p.confirming=!1,s("success",v)}function H(){p.confirming=!1}async function y(){p.init=!0;try{const v=await m();return p.confirming=!0,d({id:v.hash,type:"tx",action:"invest",summary:a("transactionSummary.investInPool",[i(l.value,K.fiat),w(t.pool)]),details:{total:i(l.value,K.fiat),pool:t.pool}}),v}catch(v){throw p.confirming=!1,new Error("Failed to submit transaction.",{cause:v})}finally{p.init=!1}}return to(()=>{b()}),(v,q)=>{const z=Oo,D=Qe;return u(),O("div",null,[I(Re,null,{default:L(()=>[!o(p).confirmed||!o(p).receipt?(u(),T(Ro,{key:0,actions:B.value,primaryActionType:"invest",disabled:o(c)||o(k),onSuccess:P,onFailed:H},null,8,["actions","disabled"])):(u(),O("div",is,[I(No,{txReceipt:o(p).receipt},null,8,["txReceipt"]),o(h)===v.pool.id?(u(),T(D,{key:0,tag:"router-link",to:{name:"get-vebal",query:{returnRoute:v.$route.name,returnParams:JSON.stringify({id:v.pool.id,networkSlug:o(A)})}},color:"gradient",block:"",class:"flex mt-2"},{default:L(()=>[I(z,{class:"mr-2 h-5 text-orange-300"}),X(F(v.$t("lockToGetVeBAL")),1)]),_:1},8,["to"])):o(g)?(u(),T(D,{key:1,color:"gradient",block:"",class:"flex mt-2",onClick:q[0]||(q[0]=oe=>s("showStakeModal"))},{default:L(()=>[I(z,{class:"mr-2 h-5 text-orange-300"}),X(F(v.$t("stakeToGetExtra")),1)]),_:1})):N("",!0),I(D,{tag:"router-link",to:{name:"pool",params:{id:v.pool.id}},color:"gray",outline:"",block:"",size:"sm",class:"mt-2"},{default:L(()=>[X(F(v.$t("returnToPool")),1)]),_:1},8,["to"])]))]),_:1}),I(Re,{name:"pop"},{default:L(()=>[o(p).confirming||o(p).confirmed?(u(),T(Wo,{key:0,class:"mt-3"})):N("",!0)]),_:1})])}}}),rs={class:"flex items-center"},cs=W({__name:"AddLiquidityPreview",props:{pool:{}},emits:["close","showStakeModal"],setup(n,{emit:e}){const t=n,s=e,a=V(!1),{t:i}=xe(),{getToken:d}=ee(),{toFiat:h}=de(),{isSingleAssetJoin:g,amountsIn:k,bptOut:w,fiatValueIn:c,fiatValueOut:l,priceImpact:m,highPriceImpact:p,rektPriceImpact:b,isLoadingQuery:$,txInProgress:A,queryJoinQuery:_,missingPricesIn:B,resetAmounts:P}=te(),H=r(()=>a.value?i("investment.preview.titles.confirmed"):i("investment.preview.titles.default")),y=r(()=>!!Object.keys(D.value).length),v=r(()=>{const x={};return k.value.forEach(C=>{x[C.address]=C.value}),x}),q=r(()=>({[t.pool.address]:w.value})),z=r(()=>{const x={};return Object.keys(v.value).forEach(C=>{x[C]=d(C)}),x}),D=r(()=>({[t.pool.address]:d(t.pool.address)})),oe=r(()=>{const x={};return Object.keys(v.value).forEach(C=>{x[C]=h(v.value[C],C)}),x}),se=r(()=>l.value?{[t.pool.address]:l.value}:{}),S=r(()=>Object.values(se.value).reduce((x,C)=>j(x).plus(C).toString(),"0"));function E(){a.value&&(P(),a.value=!1),s("close")}function U(){E(),s("showStakeModal")}return Ze(()=>{!$.value&&!A.value&&_.refetch()},Ke*10),(x,C)=>{const M=Be,G=Jo,me=st,ve=oo;return u(),T(ve,{show:"",fireworks:a.value,onClose:E},{header:L(()=>[J("div",rs,[a.value?(u(),T(G,{key:0,size:"8",color:"green",class:"mr-2 text-white"},{default:L(()=>[I(M,{name:"check"})]),_:1})):N("",!0),J("h4",null,F(H.value),1)])]),default:L(()=>[I(Ve,{title:x.$t("investment.preview.titles.tokenIn"),amountMap:v.value,tokenMap:z.value,fiatAmountMap:oe.value,fiatTotal:o(c),hideAmountShare:o(g)},null,8,["title","amountMap","tokenMap","fiatAmountMap","fiatTotal","hideAmountShare"]),y.value?(u(),T(Ve,{key:0,showZeroAmounts:"",title:x.$t("investment.preview.titles.tokenOut"),class:"mt-4",amountMap:q.value,tokenMap:D.value,fiatAmountMap:se.value,fiatTotal:S.value,hideAmountShare:""},null,8,["title","amountMap","tokenMap","fiatAmountMap","fiatTotal"])):N("",!0),o(B)?(u(),T(me,{key:1,type:"warning",title:x.$t("noPriceInfo"),class:"mt-4",block:""},null,8,["title"])):N("",!0),I(ns,{pool:x.pool,fiatTotal:o(B)?"-":o(c),priceImpact:o(m),highPriceImpact:o(p),class:"mt-4"},null,8,["pool","fiatTotal","priceImpact","highPriceImpact"]),o(b)?(u(),T(me,{key:2,type:"error",title:x.$t("investment.error.rektPriceImpact.title"),description:x.$t("investment.error.rektPriceImpact.description"),class:"mt-6 mb-2"},null,8,["title","description"])):N("",!0),I(ls,{pool:x.pool,class:"mt-4",onSuccess:C[0]||(C[0]=Le=>a.value=!0),onShowStakeModal:U},null,8,["pool"])]),_:1},8,["fireworks"])}}});function us(n,e,t=V(!1)){const s=ue,{balanceFor:a}=ee(),i=r(()=>{const c=Object.keys(e.value);return t.value?c.map(l=>R(l,s.network.tokens.Addresses.wNativeAsset)?s.network.nativeAsset.address:l):c}),d=r(()=>{var c;return(c=n.onchain)!=null&&c.tokens?n.onchain.tokens:{}}),h=r(()=>{var m;if(!((m=n.onchain)!=null&&m.tokens))return{};const c=Z(d.value,s.network.tokens.Addresses.wNativeAsset),l={[s.network.nativeAsset.address]:re((c==null?void 0:c.balance)||"0",(c==null?void 0:c.decimals)||18)};return Object.keys(d.value).forEach(p=>{const b=so(p),$=Z(d.value,b);$&&(l[b]=re($.balance,$.decimals||18))}),l});function g(c,l){if(R(c,l.address))return l.value;const m=Z(e.value,c),p=Z(h.value,c)||re("0"),b=Z(e.value,l.address),$=re(l.value,b==null?void 0:b.decimals),A=Z(h.value,l.address)||re("0"),_=$.mul(p).div(A);return ao(_,m==null?void 0:m.decimals)}function k(c){return c.value.trim()===""?[]:i.value.map(l=>({address:l,valid:!0,value:g(l,c)}))}function w(){let c=i.value.map(l=>({address:l,valid:!0,value:"0"}));return i.value.forEach(l=>{var $,A;let m=!0,p;if(R(l,s.network.nativeAsset.address)){const _=a(l);p=_?j(_).minus(s.network.nativeAsset.minTransactionBuffer).toString():"0"}else p=a(l);const b=k({address:l,value:p,valid:!0});if(b.forEach(_=>{j(_.value).gt(a(_.address))&&(m=!1)}),m){const _=(($=c.find(P=>R(P.address,l)))==null?void 0:$.value)||"0",B=((A=b.find(P=>R(P.address,l)))==null?void 0:A.value)||"0";j(B).gt(_)&&(c=b)}}),c}return{getPropMax:w}}function ds(n){const{poolJoinTokens:e,highPriceImpact:t,supportsProportionalOptimization:s,amountsIn:a,tokensIn:i,setAmountsIn:d}=te(),{isWethOrEth:h,nativeAsset:g,balanceFor:k}=ee(),{tokensWithBalanceFrom:w,tokensWithoutBalanceFrom:c}=zo(),l=r(()=>a.value.some(y=>R(y.address,g.address))),{getPropMax:m}=us(n,i,l),p=r(()=>({"dark:bg-gray-800":!t.value,"bg-red-500 dark:bg-red-500 text-white divide-red-400":t.value})),b=r(()=>({"text-gradient":!t.value,"text-red-500 px-2 py-1 bg-white rounded-lg":t.value})),$=r(()=>{const y=c(e.value).filter(v=>!h(v)).length===0;if(Ne(n)){const v=w(e.value).some(q=>h(q));return y&&v}return y}),A=r(()=>{const y=w(e.value).filter(v=>!h(v)).length>0;if(Ne(n)){const v=w(e.value).some(q=>h(q));return y||v}return y}),_=r(()=>a.value.every(y=>{if(R(y.address,g.address)){const v=k(y.address);return y.value===j(v).minus(g.minTransactionBuffer).toString()}else return y.value===k(y.address)})),B=r(()=>{if(!s.value)return!1;const y=m();return a.value.every((v,q)=>Number(v.value)===Number(y[q].value))});function P(){a.value.forEach(y=>{if(R(y.address,g.address)){const v=k(y.address);y.value=j(v).gt(g.minTransactionBuffer)?j(v).minus(g.minTransactionBuffer).toString():"0"}else y.value=k(y.address)})}function H(){const y=m();d(y)}return{priceImpactClasses:p,optimizeBtnClasses:b,hasBalanceForAllTokens:$,hasBalanceForSomeTokens:A,optimized:B,maximized:_,maximizeAmounts:P,optimizeAmounts:H}}const ps=n=>(no("data-v-aafbbf64"),n=n(),io(),n),ms={class:"data-table"},vs={class:"data-table-row total-row"},fs={class:"p-2"},hs={class:"data-table-number-col"},gs={key:0,class:"text-sm"},ks={key:0,class:"text-gray-400 dark:text-gray-600"},_s={class:Y(["data-table-row secondary-row"])},ys=ps(()=>J("div",{class:"p-2"},"LP tokens",-1)),ws={class:"data-table-number-col"},bs={class:"flex"},As={key:0},Ts={class:"p-2"},Ss={class:"data-table-number-col"},Is={class:"flex"},Ps={key:0},xs={key:0,class:"text-sm font-semibold"},$s={key:0,class:"text-gray-400 dark:text-gray-600"},Bs=W({__name:"AddLiquidityTotals",props:{pool:{}},setup(n){const e=n,{fNum:t}=de(),{isWalletReady:s}=_e(),{slippage:a}=Pe(),{highPriceImpact:i,isLoadingQuery:d,priceImpact:h,supportsProportionalOptimization:g,fiatValueIn:k,bptOut:w}=te(),{priceImpactClasses:c,optimizeBtnClasses:l,hasBalanceForAllTokens:m,hasBalanceForSomeTokens:p,optimized:b,maximized:$,maximizeAmounts:A,optimizeAmounts:_}=ds(e.pool);return(B,P)=>{const H=ke,y=Be,v=Me;return u(),O("div",ms,[J("div",vs,[J("div",fs,F(B.$t("total")),1),J("div",hs,[X(F(o(t)(o(k),o(K).fiat))+" ",1),o(s)&&o(p)?(u(),O("div",gs,[o($)?(u(),O("span",ks,F(B.$t("maxed")),1)):(u(),O("span",{key:1,class:"text-blue-500 cursor-pointer",onClick:P[0]||(P[0]=(...q)=>o(A)&&o(A)(...q))},F(B.$t("max")),1))])):N("",!0)])]),J("div",_s,[ys,J("div",ws,[J("div",bs,[o(d)?(u(),T(H,{key:1,class:"w-10"})):(u(),O("span",As,F(o(t)(o(w),o(K).token)),1)),I(v,{text:`LP tokens you are expected to recieve, not
          including possible slippage (${o(t)(o(a),o(K).percent)})`},{activator:L(()=>[I(y,{name:"info",size:"xs",class:"-mb-px ml-1 text-gray-400"})]),_:1},8,["text"])])])]),J("div",{class:Y(["data-table-row secondary-row",o(c)])},[J("div",Ts,F(B.$t("priceImpact")),1),J("div",Ss,[J("div",Is,[o(d)?(u(),T(H,{key:1,class:"w-10"})):(u(),O("span",Ps,F(o(t)(o(h),o(K).percent)),1)),I(v,{text:B.$t("customAmountsTip")},{activator:L(()=>[o(i)?(u(),T(y,{key:0,name:"alert-triangle",size:"xs",class:"-mb-px ml-1"})):(u(),T(y,{key:1,name:"info",size:"xs",class:"-mb-px ml-1 text-gray-400"}))]),_:1},8,["text"])]),o(s)&&o(m)&&o(g)?(u(),O("div",xs,[o(b)?(u(),O("span",$s,F(B.$t("optimized")),1)):(u(),O("span",{key:1,class:Y(["cursor-pointer",o(l)]),onClick:P[1]||(P[1]=(...q)=>o(_)&&o(_)(...q))},F(B.$t("optimize")),3))])):N("",!0)])],2)])}}});const Ms=Ye(Bs,[["__scopeId","data-v-aafbbf64"]]),Es={"data-testid":"add-liquidity-form"},Ls={key:2,class:"p-2 pb-2 mt-5 rounded-lg border dark:border-gray-700 high-price-impact"},Cs={class:"mt-4"},Js=W({__name:"AddLiquidityForm",props:{pool:{}},setup(n){const e=n,t=V(!1),s=V(!1),{managedPoolWithSwappingHalted:a,poolJoinTokens:i}=ne(pe(e,"pool")),{veBalTokenInfo:d}=Ge(),{isWalletReady:h,startConnectWithInjectedProvider:g,isMismatchedNetwork:k}=_e(),{wrappedNativeAsset:w,nativeAsset:c,getToken:l}=ee(),{isLoadingQuery:m,isSingleAssetJoin:p,amountsIn:b,highPriceImpact:$,highPriceImpactAccepted:A,hasValidInputs:_,hasAmountsIn:B,queryError:P,setTokensIn:H}=te(),y=r(()=>a.value),v=r(()=>j(e.pool.totalLiquidity).lt(Ao)),q=r(()=>{const S=[e.pool.address];return d.value&&S.unshift(d.value.address),S});async function z(S){H(S?[w.value.address]:i.value)}function D(S){const E=l(S);return E==null?void 0:E.symbol}function oe(S){return p.value?[]:We([w.value.address,c.address],S)?[w.value.address,c.address]:[]}function se(){p.value&&b.value.length>0&&(b.value[0].value="")}return ze(()=>{z(p.value)}),ge([p,i],([S,E],[U,x])=>{if(!t.value){const C=U!==S;(!uo.isEqual(x,E)||C)&&z(S)}}),(S,E)=>{const U=st,x=Mo,C=Qe;return u(),O("div",Es,[y.value?(u(),T(U,{key:0,type:"warning",title:S.$t("investment.warning.managedPoolSwappingHalted.title"),description:S.$t("investment.warning.managedPoolSwappingHalted.description"),class:"mb-5"},null,8,["title","description"])):N("",!0),v.value?(u(),T(U,{key:1,type:"warning",title:S.$t("investment.warning.lowLiquidity.title"),description:S.$t("investment.warning.lowLiquidity.description"),class:"mb-5"},null,8,["title","description"])):N("",!0),(u(!0),O(Ue,null,lo(o(b),M=>(u(),T(Lo,{key:M.address,isValid:M.valid,"onUpdate:isValid":G=>M.valid=G,address:M.address,"onUpdate:address":[G=>M.address=G,se],amount:M.value,"onUpdate:amount":G=>M.value=G,name:M.address,weight:o(ro)(S.pool,M.address),options:oe(M.address),"aria-label":"Amount of: "+D(M.address),class:"mb-4",fixedToken:!o(p),excludedTokens:q.value},null,8,["isValid","onUpdate:isValid","address","onUpdate:address","amount","onUpdate:amount","name","weight","options","aria-label","fixedToken","excludedTokens"]))),128)),I(Ms,{pool:S.pool},null,8,["pool"]),o($)?(u(),O("div",Ls,[I(x,{modelValue:o(A),"onUpdate:modelValue":E[0]||(E[0]=M=>Xe(A)?A.value=M:null),rules:[o(Co)(S.$t("priceImpactCheckbox"))],name:"highPriceImpactAccepted",size:"sm",label:S.$t("priceImpactAccept",[S.$t("depositing")])},null,8,["modelValue","rules","label"])])):N("",!0),I(as,{pool:S.pool,class:"mt-5"},null,8,["pool"]),o(P)?(u(),T(U,{key:3,type:"error",title:S.$t("thereWasAnError"),description:o(P),class:"mt-4",block:""},null,8,["title","description"])):N("",!0),J("div",Cs,[o(h)?(u(),T(C,{key:1,label:S.$t("preview"),color:"gradient",disabled:!o(B)||!o(_)||o(k)||o(m)||!!o(P),block:"",onClick:E[1]||(E[1]=M=>t.value=!0)},null,8,["label","disabled"])):(u(),T(C,{key:0,label:S.$t("connectWallet"),color:"gradient",block:"",onClick:o(g)},null,8,["label","onClick"]))]),(u(),T(co,{to:"#modal"},[t.value?(u(),T(cs,{key:0,pool:S.pool,onClose:E[2]||(E[2]=M=>t.value=!1),onShowStakeModal:E[3]||(E[3]=M=>s.value=!0)},null,8,["pool"])):N("",!0),I(Eo,{pool:S.pool,isVisible:s.value,action:"stake",onClose:E[4]||(E[4]=M=>s.value=!1)},null,8,["pool","isVisible"])]))])}}});const qs=Ye(Js,[["__scopeId","data-v-926aff2a"]]),js={class:"w-full"},Os={class:"text-xs leading-none text-secondary"},Fs={class:"flex justify-between items-center"},Rs=W({__name:"AddLiquidityCard",props:{pool:{}},setup(n){const t=pe(n,"pool"),{network:s}=ue,{activeTab:a,resetTabs:i}=nt(),{setIsSingleAssetJoin:d}=te(),{isDeepPool:h,isPreMintedBptPool:g}=ne(t);return De(()=>i()),ge(a,k=>{d(k===Ee.SingleToken)}),(k,w)=>{const c=xo,l=po;return u(),T(l,{shadow:"xl",exposeOverflow:"",noBorder:""},{header:L(()=>[J("div",js,[J("div",Os,F(o(s).chainName),1),J("div",Fs,[J("h4",null,F(k.$t("addLiquidity")),1),I(Bo,{context:o($o).invest},null,8,["context"])]),o(h)&&o(g)?(u(),T(c,{key:0,modelValue:o(a),"onUpdate:modelValue":w[0]||(w[0]=m=>Xe(a)?a.value=m:null),tabs:o(ye),class:"p-0 m-0 -mb-px whitespace-nowrap",noPad:""},null,8,["modelValue","tabs"])):N("",!0)])]),default:L(()=>[I(qs,{pool:o(t)},null,8,["pool"])]),_:1})}}}),rt=W({__name:"Col2Layout",props:{cols:{default:"12"},gap:{default:"8"},leftSpan:{default:"6"},rightSpan:{default:"6"},maxWidth:{default:"3xl"}},setup(n){const e=r(()=>({12:"lg:grid-cols-12"})),t=r(()=>({4:"lg:gap-x-4 gap-y-4",8:"lg:gap-x-8 gap-y-8"})),s=r(()=>({"3xl":"max-w-3xl"})),a=r(()=>({5:"col-span-5",6:"col-span-6",7:"col-span-7"}));return(i,d)=>(u(),O("div",{class:Y(`px-4 lg:px-0 mx-auto ${o(s)[i.maxWidth]}`)},[J("div",{class:Y(`grid grid-cols-1 ${o(e)[i.cols]} gap-x-0 ${o(t)[i.gap]}}`)},[J("div",{class:Y(o(a)[i.leftSpan])},[Te(i.$slots,"left")],2),J("div",{class:Y(o(a)[i.rightSpan])},[Te(i.$slots,"right")],2),Te(i.$slots,"default")],2)],2))}});function Ns(n){const e=mo(),{networkSlug:t}=$e(),{shouldDisableJoins:s}=Fo(n);s.value&&a(n.id);function a(i){e.push({name:"pool",params:{id:i,networkSlug:t}})}}const Hs=W({__name:"Page",props:{pool:{}},setup(n){const e=n,t=pe(e,"pool");Xo(t),Ns(e.pool);const{isDeepPool:s}=ne(t),{isMobile:a}=tt();return(i,d)=>(u(),T(rt,{leftSpan:"5",rightSpan:"7"},et({right:L(()=>[I(Rs,{pool:o(t)},null,8,["pool"])]),default:L(()=>[o(a)?(u(),T(ts,{key:0,pool:o(t),class:"mt-4",isDeepPool:o(s)},null,8,["pool","isDeepPool"])):N("",!0)]),_:2},[o(a)?void 0:{name:"left",fn:L(()=>[I(lt,{pool:o(t)},null,8,["pool"])]),key:"0"}]),1024))}}),$a=W({__name:"add-liquidity",setup(n){const t=vo().params.id.toLowerCase();Vo(t);const{pool:s,isLoadingPool:a,refetchOnchainPoolData:i}=ot(),{isMobile:d}=tt(),h=r(()=>a.value);return Ze(i,Ke*20),(g,k)=>{const w=ke;return u(),O("div",null,[o(h)||!o(s)?(u(),T(rt,{key:0,leftSpan:"5",rightSpan:"7"},et({right:L(()=>[I(w,{class:"h-96"})]),_:2},[o(d)?void 0:{name:"left",fn:L(()=>[I(w,{class:"h-24"})]),key:"0"}]),1024)):(u(),T(Hs,{key:1,pool:o(s)},null,8,["pool"]))])}}});export{$a as default};
//# sourceMappingURL=add-liquidity-22201e45.js.map
