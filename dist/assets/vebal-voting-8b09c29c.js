var M=Object.defineProperty;var Y=(o,t,e)=>t in o?M(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var A=(o,t,e)=>(Y(o,typeof t!="symbol"?t+"":t,e),e);import{_ as j}from"./BalCircle-528e0679.js";import{d as _,o as n,a as d,f as l,w as p,b as a,aD as $,at as T,t as y,C as s,fF as I,aE as E,U as k,a3 as B,B as m,a8 as L,fo as S,a6 as H,fp as J,fr as K,L as Z,fs as Q,fw as X,T as q,p as ee,g as te,_ as oe,a4 as F,a7 as G,fG as se,j as ne,v as ae,am as re,fH as ie,fI as le,fJ as ce,aM as de,bY as ue,e as pe,c as me,c9 as _e,cf as ge,fK as fe,H as he,fE as ve,bB as be}from"./index-60943df8.js";import{_ as P}from"./BalAlert-7103ffb1.js";import{_ as ye}from"./BalTextInput-8696f087.js";import{u as xe,a as ke,_ as we}from"./TimeLockedVote.vue_vue_type_script_setup_true_lang-e1963410.js";import{_ as Se}from"./BalTooltip.vue_vue_type_style_index_0_lang-8cf64573.js";import{d as Ve}from"./validations-cc161b3f.js";import{_ as $e}from"./BalChipNew.vue_vue_type_script_setup_true_lang-42797145.js";import{_ as Te}from"./TokenPills.vue_vue_type_script_setup_true_lang-ee78290c.js";import{_ as Be}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-cd43f961.js";import{_ as Ae}from"./ConfirmationIndicator.vue_vue_type_script_setup_true_lang-e065ab89.js";import{u as Ce}from"./useTxState-bfde8eab.js";import{i as C}from"./useFakeModal-29fec24d.js";import"./helpers-7076a817.js";import"./BalChip-810690c3.js";import"./numeral-088ce989.js";import"./BalAsset-68194947.js";import"./anime.es-37453147.js";const Ie={class:"px-4 lg:px-0 mx-auto max-w-6xl"},Le={key:0,class:"grid grid-cols-1 lg:grid-cols-10 gap-x-8 g:gap-x-8 gap-y-8"},Fe={class:"lg:col-span-4"},Ge={class:"lg:col-span-6"},Pe={key:1,class:"flex justify-center"},Re={class:"w-3/5"},ze=_({__name:"VotingLayout",props:{isOneColumn:{type:Boolean,default:!1}},setup(o){return(t,e)=>(n(),d("div",Ie,[t.isOneColumn?(n(),d("div",Pe,[a("div",Re,[$(t.$slots,"right")])])):(n(),d("div",Le,[l(T,null,{default:p(()=>[a("div",Fe,[$(t.$slots,"left")])]),_:3}),a("div",Ge,[$(t.$slots,"right")]),$(t.$slots,"default")]))]))}}),We={class:"flex justify-between p-2"},De={key:0},Ne={key:1},Oe={key:0,class:"mt-3 ml-2 text-sm text-red-500"},R=_({__name:"VoteAllocation",props:{message:{},shares:{},error:{type:Boolean,default:!1},withDecimals:{type:Boolean,default:!1}},setup(o){const t=o;return(e,r)=>(n(),d(B,null,[a("div",{class:E(["p-2 mb-2 text-base font-semibold rounded-lg border",t.error?"bg-red-50 dark:bg-red-500/10 border-red-200 dark:border-red-900 text-black dark:text-white":"bg-gray-100 dark:bg-gray-800 border-gray-100 dark:border-gray-800"])},[a("div",We,[a("div",null,y(t.message),1),e.withDecimals?(n(),d("div",De,y(s(I)(t.shares.toString()))+" % ",1)):(n(),d("div",Ne,y(t.shares)+" %",1))])],2),e.error?(n(),d("div",Oe," Your votes canâ€™t exceed 100% ")):k("",!0)],64))}}),Ue={class:"font-semibold"},Me={class:"text-gray-500"},Ye=_({__name:"OverLimitVote",props:{pool:{}},setup(o){const t=o,{lpVoteOverLimitWarning:e}=xe(t.pool);return(r,i)=>{const u=L,c=Se;return s(e)?(n(),m(c,{key:0,textAlign:"left"},{activator:p(()=>[l(u,{class:"ml-1",name:"alert-triangle",size:"sm"})]),default:p(()=>[a("div",null,[a("span",Ue,y(s(e).title),1),a("p",Me,y(s(e).description),1)])]),_:1})):k("",!0)}}}),je={class:"flex items-center py-2 px-3"},Ee={class:"flex justify-center items-center w-8 h-8 bg-gray-50 dark:bg-gray-800 rounded shadow-sm"},He=["src","alt"],z=_({__name:"VotePoolDetails",props:{pool:{}},setup(o){const{getIsGaugeExpired:t}=S();return(e,r)=>(n(),d("div",je,[a("div",Ee,[a("img",{src:s(H)(s(J)(e.pool.network)),alt:e.pool.network.toString(),class:"w-6 h-6"},null,8,He)]),l(Te,{class:"pl-6 font-semibold",tokens:s(K)(e.pool),isStablePool:s(Z)(e.pool.poolType)||s(Q)(e.pool.poolType)},null,8,["tokens","isStablePool"]),s(X)(e.pool)?(n(),m($e,{key:0,class:"ml-2"})):k("",!0),s(t)(e.pool.gauge.address)?(n(),m(ke,{key:1,class:"ml-2"})):k("",!0)]))}}),Je={class:"flex items-center pl-16 mt-1 h-full text-sm text-gray-500 dark:text-gray-300"},W=_({__name:"VotePoolFooter",props:{pool:{}},setup(o){return(t,e)=>(n(),d("div",Je,y(t.pool.symbol),1))}}),Ke=o=>(ee("data-v-25962d3f"),o=o(),te(),o),Ze={class:"special-input"},Qe={class:"flex items-center px-2 h-full"},Xe=Ke(()=>a("span",{class:"text-xl text-black dark:text-white"},"%",-1)),qe=_({__name:"VoteInput",props:{pool:{},modelValue:{default:""}},emits:["update:modelValue"],setup(o,{emit:t}){const e=t,r=[Ve()];return(i,u)=>{const c=ye;return n(),d("div",Ze,[l(c,q({modelValue:i.modelValue},i.$attrs,{class:"mb-2",type:"number",name:"poolVote",rules:r,inputAlignRight:"",placeholder:"0",onInput:u[0]||(u[0]=g=>e("update:modelValue",g))}),{prepend:p(()=>[l(z,{pool:i.pool},null,8,["pool"])]),append:p(()=>[a("div",Qe,[Xe,l(we,{class:"ml-2",pool:i.pool},null,8,["pool"]),l(Ye,{class:"ml-2",pool:i.pool},null,8,["pool"])])]),footer:p(()=>[l(W,{pool:i.pool},null,8,["pool"])]),_:1},16,["modelValue"])])}}});const et=oe(qe,[["__scopeId","data-v-25962d3f"]]),tt=_({__name:"VoteInputList",setup(o){const{selectedPools:t,votingRequest:e,hasExpiredPoolsSelected:r,hasTimeLockedPools:i,totalAllocatedWeight:u,isVotingRequestValid:c,isRequestingTooMuchWeight:g,isInputDisabled:b,goToSubmissionStep:x}=S();return(f,h)=>{const V=P,N=G;return n(),d("div",null,[s(i)?(n(),m(V,{key:0,type:"tip",class:"mb-3",title:"You have a timelocked pool gauge",description:"You are not able to edit the votes on any pool gauge that you voted on within the last 10 days."})):k("",!0),s(r)?(n(),m(V,{key:1,type:"tip",class:"mb-3",title:"You have an expired pool",description:"Votes for expired pools must be removed. Select other pools from the veBAL page to reallocate these votes."})):k("",!0),(n(!0),d(B,null,F(s(t),(w,O)=>(n(),m(et,{key:w.gauge.address,modelValue:s(e)[w.gauge.address],"onUpdate:modelValue":U=>s(e)[w.gauge.address]=U,pool:w,disabled:s(b)(w),autoFocus:O===0},null,8,["modelValue","onUpdate:modelValue","pool","disabled","autoFocus"]))),128)),l(R,{message:"Total vote allocation",shares:s(u),error:s(g)},null,8,["shares","error"]),l(N,{class:"mt-3",size:"md",label:"Next",color:"gradient",disabled:!s(c),block:"",onClick:s(x)},null,8,["disabled","onClick"])])}}});class ot{constructor(t=ne,e=ae){A(this,"abi");this.config=t,this.walletService=e,this.abi=se}get address(){return this.config.network.addresses.gaugeController}async voteForManyGaugeWeights(t,e,r={}){return await this.walletService.txBuilder.contract.sendTransaction({contractAddress:this.address,abi:this.abi,action:"vote_for_many_gauge_weights",params:[t,e],options:r})}voteForGaugeWeights(t,e,r={}){return this.walletService.txBuilder.contract.sendTransaction({contractAddress:this.address,abi:this.abi,action:"vote_for_gauge_weights",params:[t,e],options:r})}}const st=new ot,{txState:nt,resetTxState:at}=Ce();function D(){return{txState:nt,resetTxState:at}}const{txState:v}=D();function rt({request:o,expiredGauges:t,gaugeControllerService:e=st}){const{addTransaction:r}=re(),i=u();function u(){return o.length>8?[c(1),c(2)]:[c()]}function c(f=1){const h=dt(o,f),V=()=>g(h);return{label:lt(o,t),loadingLabel:"Confirm voting in wallet",confirmingLabel:"Voting",stepTooltip:it(f),action:V}}async function g(f){v.init=!0;try{const h=await ct(f,e);return v.confirming=!0,r({id:h.hash,type:"tx",action:"voteForGauge",summary:ut(f),details:pt(f)}),h}catch(h){throw v.confirming=!1,console.log(h),new Error("Failed to submit votes.",{cause:h})}finally{v.init=!1}}async function b(f,h){console.log("Voting receipt",f),le(),v.receipt=f,v.confirmedAt=h,v.confirmed=!0,v.confirming=!1}function x(){v.confirming=!1}return{txState:v,votingActions:i,handleSuccess:b,handleFailed:x}}function it(o){return o===1?"Confirm first batch of votes":o===2?"Confirm second batch of votes":""}function lt(o,t){return ie(o.map(e=>e.gaugeAddress),t)?o.length>1?"Remove votes":"Remove vote":o.length>1?"Confirm votes":"Confirm vote"}async function ct(o,t){const e=o.map(c=>c.gaugeAddress),r=o.map(c=>ce(c.weight)),i=new Array(8-e.length).fill(de.ZeroAddress),u=new Array(8-e.length).fill(ue.from(0));return console.log("Voting:",{addresses:[...e,...i],weights:[...r.map(c=>c.toNumber()),...u.map(c=>c.toNumber())]}),await t.voteForManyGaugeWeights([...e,...i],[...r,...u])}function dt(o,t){return t===2?o.slice(8):o.length>=8?o.slice(0,8):o}function ut(o){return o.length>1?`Voting on ${o.length} pools`:"Voting on 1 pool"}function pt(o){return{gaugeAddresses:o.map(t=>t.gaugeAddress),votes:o.map(t=>t.weight)}}const mt={key:1},_t=_({__name:"VotingActions",props:{request:{},expiredGauges:{}},setup(o){const t=o,{handleFailed:e,handleSuccess:r,txState:i,votingActions:u}=rt(t);return(c,g)=>{const b=G;return n(),m(T,null,{default:p(()=>[!s(i).confirmed||!s(i).receipt?(n(),m(Be,{key:0,actions:s(u),primaryActionType:"voteForGauge",onSuccess:s(r),onFailed:s(e)},null,8,["actions","onSuccess","onFailed"])):(n(),d("div",mt,[l(Ae,{txReceipt:s(i).receipt},null,8,["txReceipt"]),l(b,{tag:"router-link",to:{name:"vebal",params:{networkSlug:"ethereum"}},color:"gray",outline:"",block:"",class:"mt-2"},{default:p(()=>[pe(" Return to veBAL list ")]),_:1})]))]),_:1})}}}),gt={class:"p-1 mb-2 text-base dark:bg-gray-800 rounded-lg border border-gray-100 dark:border-gray-800 shadow-inner"},ft={class:"flex justify-between"},ht={class:"mt-2"},vt={class:"flex items-center pr-4 h-full font-semibold"},bt={class:"text-xl text-black dark:text-white"},yt=_({__name:"ConfirmedVote",props:{pool:{}},setup(o){const{votingRequest:t}=S();return(e,r)=>(n(),d("div",gt,[a("div",ft,[l(z,{pool:e.pool},null,8,["pool"]),a("div",ht,[a("div",vt,[a("span",bt,y(s(I)(s(t)[e.pool.gauge.address]))+" % ",1)])])]),l(W,{pool:e.pool},null,8,["pool"])]))}}),xt=_({__name:"VotingSubmission",setup(o){const{unlockedSelectedPools:t,totalAllocatedWeight:e,expiredGauges:r,confirmedVotingRequest:i,shouldBatchVotes:u}=S();return(c,g)=>{const b=P;return n(),d("div",null,[s(u)?(n(),m(b,{key:0,type:"tip",class:"mb-3",title:"Your votes have been batched",description:"The protocol only supports up to 8 votes per transaction, so additional votes will be confirmed afterwards."})):k("",!0),(n(!0),d(B,null,F(s(t),x=>(n(),m(yt,{key:x.gauge.address,pool:x},null,8,["pool"]))),128)),l(R,{message:"Total vote allocation",shares:s(e),withDecimals:""},null,8,["shares"]),l(_t,{request:s(i),expiredGauges:s(r)},null,8,["request","expiredGauges"])])}}}),kt=a("div",{class:"p-3 w-full"},[a("h6",null,"How it works")],-1),wt={class:"p-3 -mt-2"},St={class:"flex justify-between items-center w-full"},Vt={class:"flex items-center"},$t=_({__name:"MultiVoting",setup(o){const{isSubmissionStep:t}=S(),{txState:e,resetTxState:r}=D(),i=me(()=>e.confirmed?"Your votes were registered ðŸŽ‰":"Pool gauge voting");return _e(()=>r()),(u,c)=>{const g=he,b=L,x=j;return n(),d("div",null,[l(ze,{isOneColumn:s(e).confirmed},ge({right:p(()=>[l(g,{class:"relative card-container",shadow:"xl",noBorder:""},{header:p(()=>[a("div",St,[a("div",Vt,[s(e).confirmed?(n(),m(x,{key:0,size:"8",color:"green",class:"mr-2 text-white"},{default:p(()=>[l(b,{name:"check"})]),_:1})):k("",!0),a("h4",null,y(s(i)),1)])])]),default:p(()=>[s(t)?(n(),m(T,{key:1,name:"appear",appear:""},{default:p(()=>[l(xt)]),_:1})):(n(),m(tt,{key:0}))]),_:1})]),_:2},[s(e).confirmed?void 0:{name:"left",fn:p(()=>[l(g,{noPad:"",shadow:"none"},{default:p(()=>[kt,a("div",wt," Your vote directs liquidity mining emissions for the future periods starting next Thursday at 0:00 UTC. Voting power is set at the time of a vote. If you get more veBAL later, resubmit your vote to use your increased power. Votes are timelocked for 10 days. If you vote now, no edits can be made until "+y(s(fe)())+". ",1)]),_:1})]),key:"0"}]),1032,["isOneColumn"])])}}}),Et=_({__name:"vebal-voting",setup(o){return ve(),C.value=!0,be(()=>C.value=!1),(t,e)=>(n(),m($t))}});export{Et as default};
//# sourceMappingURL=vebal-voting-8b09c29c.js.map
