import{r as B,Q as $,c as o,m as x,gp as W,j as Q,c1 as z,c8 as T,E as V,bu as X,l as Z,u as J,g7 as ee,X as d,aM as U,Z as ae,G as te,c7 as re,O as y,cc as se,z as oe}from"./index-60943df8.js";function ue(r,t={}){const c=B($.Pool.Gauges(r)),i=o(()=>!!(r!=null&&r.value)),u=o(()=>{var s,v;return{__name:"PoolGauges",pool:{__args:{id:(s=r.value)==null?void 0:s.toLowerCase()},preferentialGauge:{id:!0},gauges:{id:!0,relativeWeightCap:!0}},liquidityGauges:{__args:{where:{poolAddress:(v=r.value)==null?void 0:v.toLowerCase()}},id:!0}}}),f=async()=>{try{return await W({url:Q.network.subgraphs.gauge,query:u.value})}catch(s){throw console.error(`Failed to fetch pool gauge for pool: ${r.value}`,{cause:s}),s}},n=B({enabled:i,refetchOnWindowFocus:!1,...t});return x(c,f,n)}const ne=r=>{const t=V(r),c=o(()=>t.value?X(t.value):void 0),{balanceFor:i}=Z(),{account:u,isWalletReady:f}=J(),n=ue(c),{data:s,refetch:v}=n,{userGaugeSharesQuery:w,userBoostsQuery:G,stakedSharesQuery:S}=ee(),{data:h,refetch:_}=w,{data:b,refetch:L}=G,{data:p,refetch:k,isRefetching:E}=S,C=o(()=>d(n)||f.value&&(d(S)||d(w)||d(G))),g=o(()=>{var e,a,l;return(l=(a=(e=s.value)==null?void 0:e.pool)==null?void 0:a.preferentialGauge)==null?void 0:l.id}),F=o(()=>{var e,a,l;return!!t.value&&((l=(a=(e=s.value)==null?void 0:e.liquidityGauges)==null?void 0:a[0])==null?void 0:l.id)!==void 0&&U.Stakable.VotingGaugePools.concat(U.Stakable.AllowList).includes(t.value)}),I=o(()=>{var e;return t.value&&((e=p==null?void 0:p.value)==null?void 0:e[t.value])||"0"}),O=o(()=>!b.value||!t.value?"1":b[t.value]||"1"),R=o(()=>{var e;return((e=s.value)==null?void 0:e.pool.gauges.map(a=>a.id))||[]}),K=o(()=>h.value?h.value.reduce((e,a)=>(e[a.gauge.id]=a.balance,e),{}):{}),M=o(()=>{if(!s.value||!h.value||!g.value)return!1;const e=g.value;return R.value.some(a=>!ae(a,e)&&te(K.value[a]||"0").gt(0))});function N(e){t.value=e}async function j(){return Promise.all([v(),k(),_(),L()])}async function A(){if(!c.value)throw new Error("No pool to stake.");if(!g.value)throw new Error(`No preferential gauge found for this pool: ${t.value}`);const e=new y(g.value),a=se(i(oe(c.value)));return await e.stake(a)}async function D(){var P,m;if(!((m=(P=s.value)==null?void 0:P.pool)!=null&&m.gauges))throw new Error("Unable to unstake, no pool gauges");const a=(await le(s.value,u.value))[0],l=new y(a.id),Y=await l.balance(u.value);return await l.unstake(Y)}async function H(e){try{return(await W({url:Q.network.subgraphs.gauge,query:{pool:{__args:{id:e.toLowerCase()},preferentialGauge:{id:!0}}}})).pool.preferentialGauge.id}catch(a){throw console.error(a),a}}return{isLoading:C,stakedShares:I,isStakablePool:F,boost:O,hasNonPrefGaugeBalance:M,isRefetchingStakedShares:E,refetchStakedShares:k,preferentialGaugeAddress:g,fetchPreferentialGaugeAddress:H,setCurrentPool:N,refetchAllPoolStakingData:j,stake:A,unstake:D,poolGauges:s}},q=Symbol(re.Providers.PoolStaking);function ie(r){z(q,ne(r))}function ge(){return T(q)}async function le(r,t){const i=(await Promise.all(r.pool.gauges.map(async u=>{const n=await new y(u.id).balance(t);return{...u,balance:n==null?void 0:n.toString()}}))).filter(u=>u.balance!=="0");if(i.length===0)throw new Error("User doesn't have any balance for any gauges.");return i}export{ie as p,ge as u};
//# sourceMappingURL=pool-staking.provider-018db08c.js.map
