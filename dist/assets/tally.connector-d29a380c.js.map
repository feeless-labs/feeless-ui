{"version":3,"file":"tally.connector-d29a380c.js","sources":["../../src/services/web3/connectors/tally/tally.connector.ts"],"sourcesContent":["import { WalletError } from '@/types';\n\nimport { Connector, ConnectorId } from '../connector';\n\nexport class TallyConnector extends Connector {\n  id = ConnectorId.InjectedTally;\n  async connect() {\n    const provider =\n      (window as any).ethereum ||\n      ((window as any).web3 && (window as any).web3.currentProvider);\n\n    if (provider) {\n      this.provider = provider;\n      this.active.value = true;\n\n      let accounts = null;\n      let chainId = null;\n      // try the best practice way of get accounts with eth_requestAccounts && eth_chainId\n      try {\n        if (provider.request) {\n          accounts = await provider.request({\n            method: 'eth_requestAccounts',\n          });\n\n          chainId = await provider.request({ method: 'eth_chainId' });\n        }\n      } catch (err) {\n        if ((err as WalletError).code === 4001) {\n          // EIP-1193 userRejectedRequest error\n          // If this happens, the user rejected the connection request.\n          console.log('Please connect to MetaMask.');\n        } else {\n          console.error(err);\n        }\n      }\n\n      // if account is still moot, try the bad old way - enable()\n      if (!accounts) {\n        // have to any it, since enable technically shouldn't be there anymore.\n        // but might, for legacy clients.\n        const response = await (provider as any).enable();\n        accounts = response?.result || response;\n      }\n\n      if (accounts && chainId) {\n        this.handleChainChanged(chainId);\n        this.handleAccountsChanged(accounts);\n      }\n    } else {\n      console.error(\n        'Tried to connect to MetaMask but it was not detected. Please install MetaMask.'\n      );\n    }\n    return {\n      // TODO type this\n      provider: provider as any,\n      account: this.account,\n      chainId: this.chainId,\n    };\n  }\n}\n"],"names":["TallyConnector","Connector","__publicField","ConnectorId","provider","accounts","chainId","err","response"],"mappings":"yNAIO,MAAMA,UAAuBC,CAAU,CAAvC,kCACLC,EAAA,UAAKC,EAAY,eACjB,MAAM,SAAU,CACd,MAAMC,EACH,OAAe,UACd,OAAe,MAAS,OAAe,KAAK,gBAEhD,GAAIA,EAAU,CACZ,KAAK,SAAWA,EAChB,KAAK,OAAO,MAAQ,GAEpB,IAAIC,EAAW,KACXC,EAAU,KAEV,GAAA,CACEF,EAAS,UACAC,EAAA,MAAMD,EAAS,QAAQ,CAChC,OAAQ,qBAAA,CACT,EAEDE,EAAU,MAAMF,EAAS,QAAQ,CAAE,OAAQ,cAAe,SAErDG,EAAK,CACPA,EAAoB,OAAS,KAGhC,QAAQ,IAAI,6BAA6B,EAEzC,QAAQ,MAAMA,CAAG,CAErB,CAGA,GAAI,CAACF,EAAU,CAGP,MAAAG,EAAW,MAAOJ,EAAiB,SACzCC,GAAWG,GAAA,YAAAA,EAAU,SAAUA,CACjC,CAEIH,GAAYC,IACd,KAAK,mBAAmBA,CAAO,EAC/B,KAAK,sBAAsBD,CAAQ,EACrC,MAEQ,QAAA,MACN,gFAAA,EAGG,MAAA,CAEL,SAAAD,EACA,QAAS,KAAK,QACd,QAAS,KAAK,OAAA,CAElB,CACF"}