import{d as O,y as Y,o as _,B as g,w as s,f as n,e as I,t as u,b as v,C as a,F,E as h,l as K,x as aa,am as ea,z as q,c as N,G as H,b7 as Z,a1 as j,a2 as ta,fN as oa,u as sa,bp as J,U as L,at as na,a8 as ia,aY as la,a7 as ca,bc as ra,aB as ua,ay as ma}from"./index-60943df8.js";import{_ as da}from"./BalVStack.vue_vue_type_script_setup_true_lang-a25ce916.js";import{A as pa,_ as fa}from"./BalActionSteps.vue_vue_type_script_setup_true_lang-cd43f961.js";import{_ as ka}from"./BalAssetSet-c1957457.js";import{_ as _a}from"./BalCircle-528e0679.js";import{_ as ga}from"./ConfirmationIndicator.vue_vue_type_script_setup_true_lang-e065ab89.js";import{_ as ha,a as va}from"./BalDataListRow.vue_vue_type_script_setup_true_lang-bc4f6b21.js";import{_ as ya}from"./BalTooltip.vue_vue_type_style_index_0_lang-8cf64573.js";import{u as Aa,A as wa}from"./useTokenApprovalActions-885c33f2.js";import{u as Q}from"./pool-staking.provider-018db08c.js";import{_ as Sa}from"./FeedbackCard.vue_vue_type_script_setup_true_lang-f0ae37aa.js";const ba={class:"lowercase"},$a={class:"capitalize"},Ta={class:"capitalize"},Ba=O({__name:"StakeSummary",props:{action:{},fiatValue:{},sharePercentage:{}},setup(e){const{fNum:d}=Y();return(t,p)=>{const i=ya,r=ha,c=va;return _(),g(c,{title:t.$t("summary")},{default:s(()=>[n(r,null,{label:s(()=>[I(u(t.$t("totalValueTo"))+" Â  ",1),v("span",ba,u(t.action==="stake"?t.$t("stake"):t.$t("unstake"))+": ",1)]),value:s(()=>[v("span",$a,u(a(d)(t.fiatValue,a(F).fiat)),1),n(i,{text:t.action==="stake"?t.$t("staking.stakeValueTooltip"):t.$t("staking.unstakeValueTooltip"),width:"40",textAlign:"center",class:"ml-2"},null,8,["text"])]),_:1}),n(r,{label:t.$t("staking.newTotalShare")},{value:s(()=>[v("span",Ta,u(a(d)(t.sharePercentage,a(F).percent)),1),n(i,{text:t.$t("staking.totalShareTooltip"),width:"40",textAlign:"center",class:"ml-2"},null,8,["text"])]),_:1},8,["label"])]),_:1},8,["title"])}}});function Ca(e,d){const t=h(!1),p=h(!1),i=h(!1),r=h(),c=h([]),{balanceFor:m,refetchBalances:f}=K(),{fNum:y}=Y(),{t:l}=aa(),{addTransaction:b}=ea(),{getTokenApprovalActions:z}=Aa(),{isLoading:R,stake:M,unstake:D,stakedShares:$,refetchAllPoolStakingData:G,preferentialGaugeAddress:o}=Q(),k=e.action==="stake"?m(q(e.pool.address)):$.value,T={label:l("stake"),loadingLabel:l("staking.staking"),confirmingLabel:l("confirming"),action:()=>P(M,"stake"),stepTooltip:l("staking.stakeTooltip")},B={label:l("unstake"),loadingLabel:l("staking.unstaking"),confirmingLabel:l("confirming"),action:()=>P(D,"unstake"),stepTooltip:e.action==="restake"?l("staking.restakeTooltip"):l("staking.unstakeTooltip")},A=N(()=>e.action==="stake"&&(k==="0"||k==="")),E=h(H(H($.value).plus(m(q(e.pool.address)))).div(e.pool.totalShares).toString()),U=N(()=>[{address:e.pool.address,amount:k}]),C=N(()=>t.value||R.value);async function P(S,W){try{const V=await S();return i.value=!0,b({id:V.hash,type:"tx",action:W,summary:l(`transactionSummary.${W}`,{pool:e.pool.symbol,amount:y(Z(e.pool,k),F.fiat)}),details:{total:y(Z(e.pool,k),F.fiat),pool:e.pool}}),V}catch(V){throw i.value=!1,new Error(`Failed create ${W} transaction`,{cause:V})}}async function w(){const S=await oa(async()=>{if(o.value)return await z({amountsToApprove:U.value,spender:o.value,actionType:wa.Staking})},t);S&&c.value.unshift(...S)}async function X(S){p.value=!0,i.value=!1,r.value=S,await Promise.all([f(),G()]),d("success")}function x(){p.value=!1,i.value=!1,r.value=void 0,d("close")}return j(()=>e.action,()=>{e.action==="stake"&&(c.value=[T]),e.action==="unstake"&&(c.value=[B]),e.action==="restake"&&(c.value=[B,T])},{immediate:!0}),j(o,async()=>{e.action!=="unstake"&&await w()}),ta(async()=>{e.action!=="unstake"&&await w()}),{isActionConfirmed:p,isActionConfirming:i,confirmationReceipt:r,isLoading:C,currentShares:k,stakeActions:c,totalUserPoolSharePct:E,handleSuccess:X,handleClose:x,isStakeAndZero:A}}const Pa={class:"py-2 px-4 rounded-lg border dark:border-gray-700 divide-y dark:divide-gray-700"},Va={class:"text-secondary"},La=O({__name:"StakePreview",props:{pool:{},action:{}},emits:["close","success"],setup(e,{emit:d}){const t=e,p=d,{getToken:i}=K(),{fNum:r}=Y(),{isMismatchedNetwork:c}=sa(),{isActionConfirmed:m,isActionConfirming:f,confirmationReceipt:y,isLoading:l,currentShares:b,stakeActions:z,totalUserPoolSharePct:R,handleSuccess:M,handleClose:D,isStakeAndZero:$}=Ca(t,p),G=N(()=>J(t.pool).length*32/1.5);return(o,k)=>{const T=ia,B=_a,A=la,E=ka,U=fa,C=ca,P=da;return _(),g(P,{spacing:"md"},{default:s(()=>[n(A,{horizontal:"",spacing:"sm",align:"center"},{default:s(()=>[a(m)?(_(),g(B,{key:0,size:"8",color:"green",class:"text-white"},{default:s(()=>[n(T,{name:"check"})]),_:1})):L("",!0),v("h4",null,u(o.$t(`${o.action}`))+" "+u(o.$t("lpTokens")),1)]),_:1}),v("div",Pa,[n(A,{horizontal:"",justify:"between",align:"center"},{default:s(()=>[n(A,{vertical:"",spacing:"none"},{default:s(()=>{var w;return[v("h5",null,u(a(r)(a(b)))+" "+u(o.$t("lpTokens")),1),v("span",Va,u((w=a(i)(o.pool.address))==null?void 0:w.symbol),1)]}),_:1}),n(E,{addresses:a(J)(o.pool),width:a(G),size:32},null,8,["addresses","width"])]),_:1})]),n(Ba,{action:o.action,fiatValue:a(Z)(o.pool,a(b)),sharePercentage:a(R)},null,8,["action","fiatValue","sharePercentage"]),a(m)?L("",!0):(_(),g(U,{key:0,actions:a(z),primaryActionType:o.action,isLoading:a(l),disabled:a($)||a(c),onSuccess:a(M)},null,8,["actions","primaryActionType","isLoading","disabled","onSuccess"])),a(m)&&a(y)?(_(),g(A,{key:1,vertical:""},{default:s(()=>[n(ga,{txReceipt:a(y)},null,8,["txReceipt"]),n(pa,{isVisible:a(m)},{default:s(()=>[o.action==="stake"?(_(),g(C,{key:0,color:"gradient",block:"",onClick:k[0]||(k[0]=w=>o.$router.push({name:"claim"}))},{default:s(()=>[I(u(o.$t("viewClaims")),1)]),_:1})):(_(),g(C,{key:1,color:"gray",outline:"",block:"",onClick:a(D)},{default:s(()=>[I(u(o.$t("close")),1)]),_:1},8,["onClick"]))]),_:1},8,["isVisible"])]),_:1})):L("",!0),n(na,{name:"pop"},{default:s(()=>[a(f)||a(m)?(_(),g(Sa,{key:0})):L("",!0)]),_:1})]),_:1})}}}),Za=O({__name:"StakePreviewModal",props:{isVisible:{type:Boolean},pool:{},action:{}},emits:["close","success"],setup(e,{emit:d}){const t=e,p=d,i=h(!1),{setCurrentPool:r}=Q();function c(){i.value=!1,p("close")}function m(){i.value=!0,p("success")}return ra(()=>{r(t.pool.id)}),j(()=>t.pool,f=>{r(f.id)}),(f,y)=>{const l=ma;return _(),g(ua,{to:"#modal"},[n(l,{show:f.isVisible,fireworks:a(i),onClose:c},{default:s(()=>[n(La,{pool:f.pool,action:f.action,onClose:c,onSuccess:m},null,8,["pool","action"])]),_:1},8,["show","fireworks"])])}}});export{Za as _};
//# sourceMappingURL=StakePreviewModal.vue_vue_type_script_setup_true_lang-d41a00fd.js.map
